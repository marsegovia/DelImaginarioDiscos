<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/Admin/adminEdit.css">
    <link rel="stylesheet" href="/style.css">
    <title>Document</title>
</head>
<body>
  <header>
        <a href="/index.html"><img src="/images/logoBlanco.png" alt=""></a>

        <nav class="menu">
            <ul>
                <li><a href="/catalogo.html">Catalogo</a></li>
            </ul>
        </nav>
    </header>
 <div class="edit-container">
    <h2>Editar producto</h2>

    <form id="editForm" enctype="multipart/form-data">
      <input type="text" id="banda" name="banda" placeholder="Banda">
      <input type="text" id="album" name="album" placeholder="Álbum">
      <input type="text" id="pais" name="pais" placeholder="País">
      <input type="text" id="estilo" name="estilo" placeholder="Estilo">
      <input type="text" id="sello" name="sello" placeholder="Sello">
      <input type="number" id="precio" name="precio" placeholder="Precio">
      <input type="number" id="stock" name="stock" placeholder="Stock">
      <input type="file" id="image" name="image">

      <button type="submit">Guardar cambios</button>
    </form>

    <p id="msg"></p>
  </div>

<script>
  document.addEventListener("DOMContentLoaded", async () => {
  const params = new URLSearchParams(window.location.search);
  const id = params.get("id");

  if (!id) {
    document.getElementById("msg").textContent = "❌ Producto inválido";
    return;
  }

  try {
    const res = await fetch(`https://delimaginariodiscos.onrender.com/products/${id}`);
    const product = await res.json();

    document.getElementById("banda").value = product.banda || "";
    document.getElementById("album").value = product.album || "";
    document.getElementById("pais").value = product.pais || "";
    document.getElementById("estilo").value = product.estilo || "";
    document.getElementById("sello").value = product.sello || "";
    document.getElementById("precio").value = product.precio || "";
    document.getElementById("stock").value = product.stock || "";

  } catch (err) {
    document.getElementById("msg").textContent = "❌ Error cargando producto";
  }
});

const form = document.getElementById("editForm");
const msg = document.getElementById("msg");

form.addEventListener("submit", async e => {
  e.preventDefault();

  const params = new URLSearchParams(window.location.search);
  const id = params.get("id");
  const formData = new FormData(form);
  const token = localStorage.getItem("adminToken");

  try {
    const res = await fetch(`https://delimaginariodiscos.onrender.com/products/${id}`, {
      method: "PUT",
      headers: {
        "Authorization": "Bearer " + token
      },
      body: formData
    });

    const data = await res.json();
    if (!res.ok) throw new Error(data.error);

    msg.textContent = "✅ Producto actualizado correctamente";
    msg.className = "success";

  } catch (err) {
    msg.textContent = "❌ " + err.message;
    msg.className = "error";
  }
});

</script>

</body>
</html>